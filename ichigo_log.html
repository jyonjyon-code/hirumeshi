<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã„ã¡ã”è¨˜éŒ²å¸³ | ä»Šæ—¥ã‚¤ãƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; text-align: center; background: #fff5f6; padding: 20px; color: #4a1a1a; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 30px; box-shadow: 0 10px 30px rgba(255,100,120,0.15); display: inline-block; width: 95%; max-width: 400px; border: 4px solid #ff4d6d; box-sizing: border-box; }
        .stats-box { background: #4a1a1a; color: #fff; border-radius: 15px; padding: 15px; margin-bottom: 20px; text-align: left; position: relative; }
        .stats-val { font-size: 20px; font-weight: 900; color: #ff4d6d; }
        .btn-stats-share { position: absolute; top: 15px; right: 15px; background: #fff; color: #000; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: #fffcfc; border: 1px solid #ffe5e9; padding: 5px; border-radius: 15px; margin-bottom: 20px; }
        .calendar-day { font-size: 10px; height: 50px; background: white; border-radius: 5px; display: flex; flex-direction: column; align-items: center; padding-top: 4px; border: 1px solid #fff5f6; }
        .cal-score { font-size: 9px; color: #ff4d6d; font-weight: 900; margin-top: 2px; }
        .cal-header { font-size: 10px; font-weight: bold; color: #ff85a1; padding: 5px 0; }

        .history-item { font-size: 12px; padding: 10px 8px; border-bottom: 1px solid #ffeef0; display: flex; align-items: center; justify-content: space-between; }
        .history-info { display: flex; flex-direction: column; text-align: left; flex-grow: 1; }
        .history-date { font-weight: bold; color: #ff4d6d; font-size: 13px; }
        .history-time { color: #888; font-size: 10px; margin-left: 5px; font-weight: normal; }
        .history-shogo { color: #666; font-size: 11px; }
        .history-score { font-weight: 900; color: #4a1a1a; margin-right: 15px; }

        .btn-del-item { background: #eee; color: #888; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; cursor: pointer; line-height: 22px; padding: 0; }
        .btn-back { display: block; margin-top: 20px; color: white; background: #ff4d6d; text-decoration: none; padding: 12px; border-radius: 50px; font-size: 14px; font-weight: bold; box-shadow: 0 4px 0 #c92a42; }
        .btn-delete-all { color: #cc0000; font-size: 11px; background: none; border: none; text-decoration: underline; cursor: pointer; float: right; }
    </style>
</head>
<body>
<div class="card">
    <h1 style="color:#ff4d6d; font-size:22px; margin-top:0;">ğŸ—“ï¸ ã„ã¡ã”è¨˜éŒ²å¸³</h1>
    
    <div class="stats-box">
        <div style="font-size:11px; color:#ff85a1; font-weight:bold;">ç´¯è¨ˆè¦³æ¸¬ãƒ‡ãƒ¼ã‚¿</div>
        <div style="margin: 5px 0;">ä»Šæœˆã®åˆè¨ˆ: <span class="stats-val" id="month-total">0.0</span> ğŸ“</div>
        <div style="margin: 5px 0;">å…¨ç´¯è¨ˆ: <span class="stats-val" id="all-total">0.0</span> ğŸ“</div>
        <div id="total-rank" style="color:#ffd700; font-weight:bold; font-size:13px; margin-top:5px;">å±æ€§: ãƒ­ãƒ¼ãƒ‰ä¸­...</div>
        <button class="btn-stats-share" onclick="shareStats()" title="ç´¯è¨ˆã‚’ã‚·ã‚§ã‚¢"><i class="fa-brands fa-x-twitter"></i></button>
    </div>

    <div id="calendar-month" style="font-size:14px; font-weight:bold; color:#ff4d6d; margin-bottom:5px;"></div>
    <div class="calendar-grid" id="calendar-grid"></div>

    <h3 style="font-size:16px; color:#ff4d6d; text-align:left; border-bottom:2px solid #ff4d6d; padding-bottom:5px;">
        ğŸ“ è¦³æ¸¬ãƒ­ã‚°ï¼ˆå€‹åˆ¥ï¼‰
        <button class="btn-delete-all" onclick="clearHistory()">å…¨æ¶ˆå»</button>
    </h3>
    <div id="history-list"></div>

    <a href="ichigo.html" class="btn-back">ã„ã¡ã”ã‚’å ±å‘Šã—ã«è¡Œã</a>
</div>

<script>
    window.onload = renderAll;

    function renderAll() {
        const history = JSON.parse(localStorage.getItem('ichigo-history') || '[]');
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth(); 
        
        let mTotal = 0, aTotal = 0;
        let dailyTotals = {}; // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆç®—ç”¨

        history.forEach(h => {
            const s = Number(h.score) || 0;
            aTotal += s;
            if(h.fullDateKey && h.fullDateKey.startsWith(`${year}-${month + 1}-`)) {
                mTotal += s;
            }
            // æ—¥ã”ã¨ã®åˆè¨ˆã‚’è¨ˆç®—
            dailyTotals[h.fullDateKey] = (dailyTotals[h.fullDateKey] || 0) + s;
        });

        document.getElementById('month-total').innerText = mTotal.toFixed(1);
        document.getElementById('all-total').innerText = aTotal.toFixed(1);
        
        let rank = aTotal >= 300 ? "ğŸ“ ã„ã¡ã”ã®ç¥æ§˜" : aTotal >= 50 ? "ã„ã¡ã”è²´æ—" : aTotal >= 10 ? "ã„ã¡ã”å›½æ°‘" : "ã„ã¡ã”å¸‚æ°‘";
        document.getElementById('total-rank').innerText = "ç¾åœ¨ã®å±æ€§: " + rank;

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();
        let html = '';
        ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(d => html += `<div class="cal-header">${d}</div>`);
        
        for(let i=0; i<firstDay; i++) html += '<div></div>';
        for(let d=1; d<=lastDate; d++){
            const targetKey = `${year}-${month + 1}-${d}`;
            const dayScore = dailyTotals[targetKey];
            html += `<div class="calendar-day">${d}${dayScore ? `<div class="cal-score">${dayScore.toFixed(1)}ğŸ“</div>` : ''}</div>`;
        }
        document.getElementById('calendar-grid').innerHTML = html;
        document.getElementById('calendar-month').innerText = `${year}å¹´ ${month + 1}æœˆ`;
        
        // å€‹åˆ¥å±¥æ­´ãƒªã‚¹ãƒˆï¼ˆæ™‚é–“ä»˜ãï¼‰
        const listHtml = history.map((h, index) => `
            <div class="history-item">
                <div class="history-info">
                    <span class="history-date">${h.date}<span class="history-time">${h.time || '--:--'}</span></span>
                    <span class="history-shogo">${h.shogo}</span>
                </div>
                <span class="history-score">${Number(h.score).toFixed(1)}ğŸ“</span>
                <button class="btn-del-item" onclick="deleteSingleEntry(${index})">Ã—</button>
            </div>
        `).join('');
        document.getElementById('history-list').innerHTML = listHtml || '<div style="color:#ccc;font-size:12px;margin-top:10px;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
    }

    function shareStats() {
        const aTotal = document.getElementById('all-total').innerText;
        const rank = document.getElementById('total-rank').innerText;
        const text = `ã€ä»Šæ—¥ã‚¤ãƒ è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã€‘\nç´¯è¨ˆæ‘‚å–é‡ï¼š${aTotal} ğŸ“\n${rank}\nã„ã¡ã”ã®è¦³æ¸¬ã‚’ç¶šã‘ã¦ã„ã¾ã™ã€‚ğŸ“\n#ä»Šæ—¥ã‚¤ãƒ #ã„ã¡ã” #ã­ã“ãŸã‚¹ã‚¿ã‚¸ã‚ª`;
        const url = "https://jyonjyon-code.github.io/hirumeshi/ichigo.html";
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
    }

    function deleteSingleEntry(index) {
        if(confirm("ã“ã®1ä»¶ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            let history = JSON.parse(localStorage.getItem('ichigo-history') || '[]');
            history.splice(index, 1);
            localStorage.setItem('ichigo-history', JSON.stringify(history));
            renderAll();
        }
    }

    function clearHistory() { if(confirm("ã™ã¹ã¦ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.removeItem('ichigo-history'); renderAll(); } }
</script>
</body>
</html>
