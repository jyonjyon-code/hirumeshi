<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»Šæ—¥ã‚¤ãƒ | ãã¿ã¯ä»Šæ—¥ã„ã¡ã”ã‚’é£Ÿã¹ãŸã‹</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ä»Šæ—¥ã‚¤ãƒ">

    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; text-align: center; background: #fff5f6; padding: 15px; color: #4a1a1a; margin: 0; }
        
        #app-guide { 
            display: none; background: #ff4d6d; color: white; padding: 12px; font-size: 11px; border-radius: 15px; 
            margin: 0 auto 15px auto; line-height: 1.6; text-align: left; max-width: 400px; 
        }

        .card { background: white; padding: 25px 20px; border-radius: 30px; box-shadow: 0 10px 30px rgba(255,100,120,0.15); display: inline-block; width: 100%; max-width: 400px; border: 4px solid #ff4d6d; box-sizing: border-box; }
        
        .main-title { color: #4a1a1a; font-size: 18px; margin-bottom: 5px; font-weight: 700; }
        .brand-badge { 
            font-size: 32px; color: #ff4d6d; margin-bottom: 25px; display: inline-block; font-weight: 900; 
            background: #fff0f3; border-radius: 15px; padding: 5px 25px; border: 4px solid #ff4d6d; 
        }
        
        .auth-section { margin-bottom: 15px; }
        .btn-login { background: white; color: #444; border: 1px solid #ddd; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; font-size: 14px; }
        .user-info { font-size: 12px; color: #ff4d6d; font-weight: bold; margin-bottom: 10px; }

        .counter-group { background: #fffcfc; border-radius: 20px; padding: 10px 15px; margin-bottom: 10px; border: 1px solid #ffe5e9; }
        .item-row { display: flex; align-items: center; justify-content: space-between; margin: 12px 0; padding-bottom: 8px; border-bottom: 1px dashed #ffe5e9; }
        .item-row:last-child { border-bottom: none; }
        
        .item-label { font-size: 14px; font-weight: bold; flex-grow: 1; text-align: left; }
        .sweet-select { font-family: 'Zen Maru Gothic', sans-serif; font-size: 13px; padding: 8px; border-radius: 10px; border: 1px solid #ff4d6d; margin-top: 8px; width: 100%; background: white; }
        
        .controls { display: flex; align-items: center; gap: 8px; }
        .count-num { font-size: 18px; font-weight: 900; min-width: 25px; }
        .btn-plus { width: 42px; height: 42px; border-radius: 50%; border: none; background: #ff4d6d; color: white; font-size: 22px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #c92a42; }
        .btn-plus:active { transform: translateY(2px); box-shadow: 0 2px 0 #c92a42; }
        .btn-minus { width: 34px; height: 34px; border-radius: 50%; border: 2px solid #ff4d6d; background: white; color: #ff4d6d; font-size: 18px; cursor: pointer; font-weight: bold; }
        
        .btn-main { background: #ff4d6d; color: white; border: none; padding: 18px 30px; border-radius: 50px; cursor: pointer; font-weight: 900; font-size: 20px; width: 100%; margin-top: 15px; box-shadow: 0 6px 0 #c92a42; }
        .btn-main:active { transform: translateY(3px); box-shadow: 0 3px 0 #c92a42; }
        
        #judgment-area { display: none; margin-top: 20px; padding: 20px; background: #fffbf0; border-radius: 20px; border: 2px dashed #ff4d6d; }
        .shogo { font-size: 22px; font-weight: 900; color: #ff4d6d; }
        .rakuten-area { margin-top: 15px; padding: 15px; border-radius: 15px; display: none; }
        .rakuten-link { color: white; font-weight: bold; text-decoration: none; font-size: 13px; display: block; padding: 10px; border-radius: 10px; }
        .rank-gold { background: #fff9e6; border-color: #ffd700; }
        .rank-gold .rakuten-link { background: #d4af37; }
        .rank-normal { background: #fff0f0; border-color: #ffccd5; }
        .rank-normal .rakuten-link { background: #ff4d6d; }

        .studio-nav { margin-top: 20px; border-top: 1px solid #ffe5e9; padding-top: 20px; }
        .btn-nav { display: block; margin-bottom: 10px; color: #ff4d6d; text-decoration: none; font-size: 14px; font-weight: bold; border: 2px solid #ff4d6d; padding: 12px; border-radius: 15px; background: white; }
        .btn-share { background: #000; color: white; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; font-size: 14px; }
        .sns-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-sns { color: white; border: none; padding: 10px; border-radius: 50px; cursor: pointer; font-weight: bold; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 12px; flex: 1; }
        .btn-x { background: #000; }
        .btn-insta { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
    </style>
</head>
<body>

<div id="app-guide">
    <i class="fa-solid fa-circle-info"></i> <strong>SNSå†…ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã”åˆ©ç”¨ä¸­ã®æ–¹ã¸</strong><br>
    è¨˜éŒ²ã‚’åŒæœŸã™ã‚‹ãŸã‚ã«ã€å³ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€ã‚’é¸ã‚“ã§ãã ã•ã„ğŸ“
</div>

<div class="card">
    <div class="main-title">ãã¿ã¯ä»Šæ—¥ ã„ã¡ã”ã‚’é£Ÿã¹ãŸã‹</div>
    <div class="brand-badge">ä»Šæ—¥ã‚¤ãƒ</div>

    <div class="auth-section">
        <div id="user-display" class="user-info" style="display:none;"></div>
        <button id="login-btn" class="btn-login">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="18"> Googleã§ãƒ­ã‚°ã‚¤ãƒ³
        </button>
    </div>

    <div class="counter-group">
        <div class="item-row">
            <div class="item-label">ğŸ“ ç”Ÿã®ã„ã¡ã”</div>
            <div class="controls">
                <button class="btn-minus" onclick="change('raw', -1)">âˆ’</button>
                <span class="count-num" id="raw-count">0</span>
                <button class="btn-plus" onclick="change('raw', 1)">ï¼‹</button>
            </div>
        </div>
        <div class="item-row">
            <div class="item-label">ğŸ¥„ ã‚¸ãƒ£ãƒ (æ¯)</div>
            <div class="controls">
                <button class="btn-minus" onclick="change('jam', -1)">âˆ’</button>
                <span class="count-num" id="jam-count">0</span>
                <button class="btn-plus" onclick="change('jam', 1)">ï¼‹</button>
            </div>
        </div>
        <div class="item-row" style="flex-direction: column; align-items: flex-start;">
            <div style="display: flex; width: 100%; justify-content: space-between; align-items: center;">
                <div class="item-label">ğŸ° ã‚¹ã‚¤ãƒ¼ãƒ„ç³»</div>
                <div class="controls">
                    <button class="btn-minus" onclick="change('sweet', -1)">âˆ’</button>
                    <span class="count-num" id="sweet-count">0</span>
                    <button class="btn-plus" onclick="change('sweet', 1)">ï¼‹</button>
                </div>
            </div>
            <select id="sweet-type" class="sweet-select">
                <option value="2.0">ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ (2.0ğŸ“)</option>
                <option value="3.0">ã„ã¡ã”ãƒ‘ãƒ•ã‚§ (3.0ğŸ“)</option>
                <option value="1.5">ã„ã¡ã”å¤§ç¦ (1.5ğŸ“)</option>
                <option value="1.0">ã„ã¡ã”ãƒãƒ§ã‚³ (1.0ğŸ“)</option>
                <option value="0.5">ã„ã¡ã”é£´/ã‚°ãƒŸ (0.5ğŸ“)</option>
                <option value="0.1">ãã®ä»– (0.1ğŸ“)</option>
            </select>
        </div>
    </div>

    <button class="btn-main" onclick="judge()">æ‘‚å–é‡ã‚’å ±å‘Šã™ã‚‹</button>

    <div id="judgment-area">
        <div class="shogo" id="shogo-text"></div>
        <p id="comment-text" style="font-size:14px; white-space: pre-wrap;"></p>
        <div id="rakuten-box" class="rakuten-area">
            <div id="rakuten-msg" style="font-size:12px; font-weight:bold; margin-bottom:8px;"></div>
            <a id="rakuten-url" href="" class="rakuten-link" target="_blank">æ¥½å¤©ã§è£œçµ¦ã™ã‚‹</a>
        </div>
        <button onclick="shareOnX()" class="btn-share">
            <i class="fa-brands fa-x-twitter"></i> å ±å‘Šã™ã‚‹
        </button>
    </div>

    <div class="studio-nav">
        <a href="ichigo_log.html" class="btn-nav">ğŸ—“ï¸ è¨˜éŒ²ã‚’ã¿ã‚‹ã€Œã„ã¡ã”ã‚ˆã¿ã€</a>
        <a href="index.html" style="color:#888; font-size:12px; text-decoration:none;">ã­ã“ãŸã‚¹ã‚¿ã‚¸ã‚ªã¸æˆ»ã‚‹</a>
        <div class="sns-group">
            <a href="https://x.com/necotatu2" target="_blank" class="btn-sns btn-x">å…¬å¼X</a>
            <a href="https://www.instagram.com/necotastudio" target="_blank" class="btn-sns btn-insta">å…¬å¼Insta</a>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA7pcr0G4qEx0yLNWueZPdaeQoEBjFuoic",
        authDomain: "necotastudio-app.firebaseapp.com",
        projectId: "necotastudio-app",
        storageBucket: "necotastudio-app.firebasestorage.app",
        messagingSenderId: "1093173509944",
        appId: "1:1093173509944:web:5340935ddffdd49628cbcd"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById('login-btn');
    const userDisplay = document.getElementById('user-display');

    loginBtn.onclick = () => signInWithPopup(auth, provider);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            loginBtn.style.display = 'none';
            userDisplay.style.display = 'block';
            userDisplay.innerText = `ğŸ“ ${user.displayName} ã•ã‚“`;
        }
    });

    let counts = { raw: 0, jam: 0, sweet: 0 };
    window.change = (type, delta) => { 
        counts[type] = Math.max(0, counts[type] + delta); 
        document.getElementById(type + '-count').innerText = counts[type];
    };

    window.judge = async () => {
        const sweetVal = parseFloat(document.getElementById('sweet-type').value);
        let score = (counts.raw * 1.0) + (counts.jam * 0.5) + (counts.sweet * sweetVal);
        
        if (score === 0) return alert("ã„ã¡ã”ã‚’é£Ÿã¹ã¦ãã ã•ã„ğŸ“");

        const now = new Date();
        const logEntry = { 
            timestamp: now.toISOString(),
            score: score
        };

        // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
        let history = JSON.parse(localStorage.getItem('ichigo-history') || '[]');
        history.unshift(logEntry);
        localStorage.setItem('ichigo-history', JSON.stringify(history));

        // Firebaseä¿å­˜
        const user = auth.currentUser;
        if (user) {
            const userRef = doc(db, "users", user.uid);
            const userSnap = await getDoc(userRef);
            if (!userSnap.exists()) {
                await setDoc(userRef, { history: [logEntry] });
            } else {
                await updateDoc(userRef, { history: arrayUnion(logEntry) });
            }
        }

        // è¡¨ç¤ºå‡¦ç†
        const dayTotal = history.reduce((sum, item) => sum + item.score, 0); // æœ¬æ¥ã¯æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãŒå¿…è¦ã§ã™ãŒã‚·ãƒ³ãƒ—ãƒ«åŒ–
        let shogo = dayTotal >= 10 ? "ã„ã¡ã”ã®åŒ–èº«" : dayTotal >= 5 ? "ã„ã¡ã”é¨å£«" : "ã„ã¡ã”æ„›å¥½å®¶";
        
        document.getElementById('shogo-text').innerText = "ã€" + shogo + "ã€‘";
        document.getElementById('comment-text').innerText = `ä»Šæ—¥ã®åˆè¨ˆ: ${dayTotal.toFixed(1)}ğŸ“`;
        document.getElementById('judgment-area').style.display = 'block';
    };

    window.shareOnX = () => {
        const text = `ã€ä»Šæ—¥ã‚¤ãƒã€‘ç§ã®ç§°å·ã¯${document.getElementById('shogo-text').innerText}ï¼ #ä»Šæ—¥ã‚¤ãƒ`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
    };
</script>
</body>
</html>
