<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šæ—¥ã‚¤ãƒ | ãã¿ã¯ä»Šæ—¥ã„ã¡ã”ã‚’é£Ÿã¹ãŸã‹</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; text-align: center; background: #fff5f6; padding: 20px; color: #4a1a1a; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 30px; box-shadow: 0 10px 30px rgba(255,100,120,0.15); display: inline-block; width: 95%; max-width: 400px; border: 4px solid #ff4d6d; box-sizing: border-box; }
        h1 { color: #ff4d6d; font-size: 24px; margin-bottom: 5px; }
        .subtitle { font-size: 12px; color: #ff85a1; margin-bottom: 20px; font-weight: bold; }
        
        .counter-group { background: #fffcfc; border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid #ffe5e9; }
        .item-row { display: flex; align-items: center; justify-content: space-between; margin: 12px 0; }
        .item-label { font-size: 16px; font-weight: bold; }
        .controls { display: flex; align-items: center; gap: 12px; }
        .btn-round { width: 32px; height: 32px; border-radius: 50%; border: none; background: #ff4d6d; color: white; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .count-num { font-size: 18px; font-weight: 900; min-width: 25px; color: #ff4d6d; }

        /* è©³ç´°å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .advanced-toggle { font-size: 12px; color: #ff85a1; cursor: pointer; text-decoration: underline; margin-bottom: 10px; display: block; }
        #advanced-area { display: none; background: #fff0f3; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #ffccd5; text-align: left; }
        .select-row { margin-bottom: 10px; }
        select { width: 100%; padding: 8px; border-radius: 10px; border: 1px solid #ff4d6d; font-family: 'Zen Maru Gothic', sans-serif; font-size: 14px; }

        #judgment-area { display: none; margin-top: 20px; padding: 20px; background: #fffbf0; border-radius: 20px; border: 2px dashed #ff4d6d; animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .shogo { font-size: 22px; font-weight: 900; color: #ff4d6d; margin: 10px 0; }
        .comment { font-size: 14px; color: #7a4a4a; line-height: 1.5; white-space: pre-wrap; }

        .btn-main { background: #ff4d6d; color: white; border: none; padding: 15px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; font-size: 18px; width: 100%; margin-top: 10px; box-shadow: 0 4px 0 #c92a42; }
        .btn-main:active { transform: translateY(2px); box-shadow: 0 2px 0 #c92a42; }
        
        .btn-rakuten { background: #bf0000; color: white; text-decoration: none; padding: 12px; border-radius: 50px; display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        .btn-back { background: #888; color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; text-decoration: none; display: inline-block; margin-top: 30px; font-size: 13px; }

        .history { margin-top: 30px; text-align: left; }
        .history h3 { font-size: 16px; color: #ff4d6d; border-bottom: 2px solid #ff4d6d; margin-bottom: 10px; }
        .history-item { font-size: 12px; padding: 8px; border-bottom: 1px solid #ffeef0; display: flex; justify-content: space-between; }
        
        .campaign-banner { background: #ff4d6d; color: white; font-size: 11px; padding: 3px 10px; border-radius: 10px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h1>ä»Šæ—¥ã‚¤ãƒ</h1>
    <div class="subtitle">ãã¿ã¯ä»Šæ—¥ã„ã¡ã”ã‚’é£Ÿã¹ãŸã‹</div>

    <div id="campaign-info" class="campaign-banner">ğŸ“ ä»Šæ—¥ã¯15æ—¥ï¼ãƒã‚¤ãƒ³ãƒˆ2å€ãƒ‡ãƒ¼ ğŸ“</div>

    <div class="counter-group">
        <div class="item-row">
            <div class="item-label">ğŸ“ ç”Ÿã®ã„ã¡ã”</div>
            <div class="controls">
                <button class="btn-round" onclick="change('raw', -1)">-</button>
                <span class="count-num" id="raw-count">0</span>
                <button class="btn-round" onclick="change('raw', 1)">+</button>
            </div>
        </div>
        <div class="item-row">
            <div class="item-label">ğŸ¥„ ã‚¸ãƒ£ãƒ (æ¯)</div>
            <div class="controls">
                <button class="btn-round" onclick="change('jam', -1)">-</button>
                <span class="count-num" id="jam-count">0</span>
                <button class="btn-round" onclick="change('jam', 1)">+</button>
            </div>
        </div>
        <div class="item-row">
            <div class="item-label">ğŸ° ã‚¹ã‚¤ãƒ¼ãƒ„ç³»</div>
            <div class="controls">
                <button class="btn-round" onclick="change('sweet', -1)">-</button>
                <span class="count-num" id="sweet-count">0</span>
                <button class="btn-round" onclick="change('sweet', 1)">+</button>
            </div>
        </div>
    </div>

    <span class="advanced-toggle" onclick="toggleAdvanced()">â–¼ ã‚‚ã£ã¨è©³ã—ãå…¥åŠ›ï¼ˆãƒãƒ§ã‚³ãƒ»é£²æ–™ãªã©ï¼‰</span>
    
    <div id="advanced-area">
        <div class="select-row">
            <select id="extra-item" onchange="addExtra()">
                <option value="0">é …ç›®ã‚’é¸æŠã—ã¦è¿½åŠ </option>
                <option value="2.0">ã„ã¡ã”å¤§ç¦ (+2.0)</option>
                <option value="1.5">ã„ã¡ã”ã‚¢ã‚¤ã‚¹ (+1.5)</option>
                <option value="0.5">ã„ã¡ã”é£´ (+0.5)</option>
                <option value="0.3">ã„ã¡ã”å‘³ã®ãƒãƒ§ã‚³ãƒ»è“å­ (+0.3)</option>
                <option value="0.2">ã„ã¡ã”ã‚ªãƒ¬ãƒ»é£²æ–™ (+0.2)</option>
            </select>
        </div>
        <div style="font-size: 12px; color: #ff4d6d; font-weight: bold;">
            è©³ç´°ãƒœãƒ¼ãƒŠã‚¹: <span id="extra-total">0.0</span> ğŸ“
        </div>
    </div>

    <button class="btn-main" onclick="judge()">æ‘‚å–é‡ã‚’å ±å‘Šã™ã‚‹</button>

    <div id="judgment-area">
        <div id="date-label" style="font-size: 11px; color: #999;"></div>
        <div class="shogo" id="shogo-text"></div>
        <p class="comment" id="comment-text"></p>
        
        <a id="rakuten-link" class="btn-rakuten" target="_blank" rel="nofollow sponsored noopener">
            ã„ã¡ã”ã‚’è£œå……ã™ã‚‹ï¼ˆæ¥½å¤©ï¼‰
        </a>
    </div>

    <div class="history">
        <h3>ğŸ“ æœ€è¿‘ã®ã„ã¡ã”è¨˜éŒ²</h3>
        <div id="history-list"></div>
    </div>

    <a href="index.html" class="btn-back">ã­ã“ãŸã‚¹ã‚¿ã‚¸ã‚ªã¸æˆ»ã‚‹</a>
</div>

<script>
    const RAKUTEN_AFID = "51366796.8818598a.51366797.ddbb51d0";
    let counts = { raw: 0, jam: 0, sweet: 0 };
    let extraScore = 0.0;

    // èµ·å‹•æ™‚ã«15æ—¥ã‹ãƒã‚§ãƒƒã‚¯
    window.onload = function() {
        const today = new Date().getDate();
        if (today === 15) {
            document.getElementById('campaign-info').style.display = 'inline-block';
        }
        displayHistory();
    };

    function change(type, delta) {
        counts[type] = Math.max(0, counts[type] + delta);
        document.getElementById(type + '-count').innerText = counts[type];
    }

    function toggleAdvanced() {
        const area = document.getElementById('advanced-area');
        area.style.display = area.style.display === 'block' ? 'none' : 'block';
    }

    function addExtra() {
        const select = document.getElementById('extra-item');
        const val = parseFloat(select.value);
        if (val > 0) {
            extraScore += val;
            document.getElementById('extra-total').innerText = extraScore.toFixed(1);
            select.value = "0"; 
        }
    }

    function judge() {
        const now = new Date();
        const date = now.getDate();
        const dateStr = `${now.getMonth()+1}/${date}`;
        
        // åŸºæœ¬è¨ˆç®—
        let total = (counts.raw * 1.0) + (counts.jam * 0.5) + (counts.sweet * 2.0) + extraScore;
        
        // 15æ—¥ãƒã‚¤ãƒ³ãƒˆ2å€
        let isCampaign = false;
        if (date === 15) {
            total = total * 2;
            isCampaign = true;
        }

        let shogo = "";
        let comment = "";

        if (total === 0) {
            shogo = "ã„ã¡ã”æ¬ ä¹ç—‡";
            comment = "ãã¿ã¯ä»Šæ—¥ã€ã„ã¡ã”ã‚’ä¸€ç²’ã‚‚é£Ÿã¹ã¦ã„ãªã„ã‚ˆã†ã ã­ã€‚æ˜æ—¥ã¯èµ¤ã„ã„ã¡ã”ã«å·¡ã‚Šä¼šãˆã¾ã™ã‚ˆã†ã«ã€‚";
        } else if (total < 2) {
            shogo = "ã„ã¡ã”åˆå¿ƒè€…";
            comment = "ã‹ã™ã‹ã«ã„ã¡ã”ã®æ°—é…ã‚’æ„Ÿã˜ãŸä¸€æ—¥ã€‚ã‚‚ã£ã¨çœŸã£èµ¤ã«æŸ“ã¾ã£ã¦ã„ã“ã†ã€‚";
        } else if (total < 8) {
            shogo = "ã„ã¡ã”æ„›å¥½å®¶";
            comment = "ãªã‹ãªã‹ã®æ‘‚å–é‡ã§ã™ã€‚ãã¿ã®è¡€ã®æ•°ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã¯ã„ã¡ã”ã«ç½®ãæ›ã‚ã£ã¦ã„ã‚‹ã‚ˆï¼";
        } else if (total < 15) {
            shogo = "ã„ã¡ã”ãƒã‚¹ã‚¿ãƒ¼";
            comment = "ç´ æ™´ã‚‰ã—ã„ï¼ã„ã¡ã”ã®å¦–ç²¾ãŒå›ã®è‚©ã§ä¼‘æ†©ã—å§‹ã‚ã‚‹ãƒ¬ãƒ™ãƒ«ã ã€‚";
        } else {
            shogo = "ã„ã¡ã”ã®åŒ–èº«";
            comment = "ã‚‚ã¯ã‚„å›è‡ªèº«ãŒã„ã¡ã”ã¨è¨€ã£ã¦ã‚‚éè¨€ã§ã¯ãªã„ã€‚ç”˜é…¸ã£ã±ã„äººç”Ÿã‚’è¬³æ­Œã—ã¦ã„ã‚‹ã­ï¼";
        }

        if (isCampaign && total > 0) {
            shogo = "ã€ç¥15æ—¥ã€‘" + shogo;
            comment = "ä»Šæ—¥ã¯15æ—¥ï¼ˆã„ã¡ã”ã®æ—¥ï¼‰ï¼ãƒã‚¤ãƒ³ãƒˆ2å€ã§ç§°å·ãŒãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ä¸­ã ã‚ˆï¼ğŸ“ğŸ“\n\n" + comment;
        }

        document.getElementById('date-label').innerText = dateStr + " ã®åˆ¤å®š";
        document.getElementById('shogo-text').innerText = "ã€" + shogo + "ã€‘";
        document.getElementById('comment-text').innerText = comment;
        document.getElementById('judgment-area').style.display = 'block';

        const keywords = ["ã‚ã¾ãŠã† ã„ã¡ã”", "ã¨ã¡ãŠã¨ã‚", "ã„ã¡ã” ã‚¹ã‚¤ãƒ¼ãƒ„", "ã„ã¡ã” è©°ã‚åˆã‚ã›"];
        const randomKey = keywords[Math.floor(Math.random() * keywords.length)];
        document.getElementById('rakuten-link').href = `https://hb.afl.rakuten.co.jp/hgc/${RAKUTEN_AFID}/?pc=https%3A%2F%2Fsearch.rakuten.co.jp%2Fsearch%2Fmall%2F${encodeURIComponent(randomKey)}%2F`;

        saveHistory(dateStr, shogo, total.toFixed(1));
    }

    function saveHistory(date, shogo, score) {
        let history = JSON.parse(localStorage.getItem('ichigo-history') || '[]');
        history.unshift({ date, shogo, score });
        history = history.slice(0, 5);
        localStorage.setItem('ichigo-history', JSON.stringify(history));
        displayHistory();
    }

    function displayHistory() {
        const history = JSON.parse(localStorage.getItem('ichigo-history') || '[]');
        const list = document.getElementById('history-list');
        list.innerHTML = history.length ? history.map(h => `
            <div class="history-item">
                <span>${h.date}</span>
                <span><strong>${h.shogo}</strong></span>
                <span>${h.score}ğŸ“</span>
            </div>
        `).join('') : '<div style="font-size:11px; color:#ccc;">ã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
    }
</script>

</body>
</html>
